var x = 100, y = 100, dx = 2, dy = 0, vidas = 3, disparo = true, xd, yd, xj, yj, xinimigo, yinimigo;
var raio = 40, raioj= 18, raiod = 4, colisao = false, corv=255, cora=0, nivel = 1

// mantém fixo o valor da posicao, evitar que a bala persiga o jogador.
var	alvox = 0;
var alvoy = 0;

var tamanhoInimigo = 80;

var x_inimigo_orig;
var y_inimigo_orig;
var fruta;
var life_fruta;

var comeco;

function setup(){
  createCanvas (500, 500); //tamanho da area
  xj = 50;
  xd = xj;
  xinimigo = 200
  yinimigo = 400
  
  x_inimigo_orig = xinimigo;
  y_inimigo_orig = yinimigo;
  fruta = true;
  life_fruta = 2;
  
  comeco = true;
    
  yj = 340;
  yd = yj;
  
  tamanhoInimigo = 80;
}

function draw(){
  
  if( comeco == true ){
	  background(0);
	  textSize(50);
	  fill(50);
      text("RUN",width/2-80 , height/2-30);
      textSize(20);
      text("Seu jogo vai começar!",width/2-130 , height/2+100 );
    var i = 0;
    //alert("Entrou");
		/*while(i <= 1000000000){
			i++;
		}*/
    comeco = false;
  }
  
  // se o disparo sumir na tela
	if (xd >= width || yd >= height) {
		xd = 2;
      	yd = x;
        alvox = x;
  		alvoy = y;
      
	}
  
	if (keyIsDown(LEFT_ARROW)){
		x -= 5;
	}
	if (keyIsDown(RIGHT_ARROW)){
		x += 5;
	}
	if (keyIsDown(UP_ARROW)){
		y -= 5;
	}
	if (keyIsDown(DOWN_ARROW)){
		y += 5;
	}
  
	// movimentação do disparo
	// se o disparo estiver ativo
	if (disparo) {
		// movimenta o disparo / tiro
		xd = xd + 3;
		yd = alvoy;
	}
 
	

	background (50); //fundo
  
	if (disparo) {
		fill (255, 255, 0)
		// desenha a elipse / disparo
		ellipse(xd,yd,8,8);
	}
  
	fill (corv, 0, cora); //cor vermelha
	ellipse (xinimigo, yinimigo, tamanhoInimigo, tamanhoInimigo);
  
  // Quando o inimigo se encontra com o jogador.
  if((xinimigo-(tamanhoInimigo/2)) >= (x-18) && (xinimigo+(tamanhoInimigo/2)) <= (x+18)){
    if( (yinimigo-(tamanhoInimigo/2)) >= (y-18) && (yinimigo+(tamanhoInimigo/2)) <= (y+18)){
      vidas-=1;
    }
  }
  
  if(tamanhoInimigo <= 5){
    nivel++;
    xinimigo = x_inimigo_orig;
    yinimigo = y_inimigo_orig;
    tamanhoInimigo = 80*nivel/2;
  }
   
  // Caso a bala atinga o inimigo.
  if( xd >= (xinimigo-(tamanhoInimigo/2)) && xd <= (xinimigo+(tamanhoInimigo/2))){
    if( yd >= (yinimigo-(tamanhoInimigo/2)) && yd <= (yinimigo+(tamanhoInimigo/2))){
       tamanhoInimigo -= 15;
      
      // Controla a repetição de tiros.
        yd = 0;
        xd = 0;
    }
  } 
  
  	// Objeto para dar mais vida para o jogador.
  	fill(255);
  	rect(400, 100, 20, 20);
  
	// desenha jogador
	fill (0, 255, 0);
	ellipse( x, y, 36, 36); // tamanho do jogador
  
  	if( alvox == 0 && alvoy == 0){
	  	alvox = x;
  		alvoy = y;
    }
  
  	// Tiro atingiu o jogador
 	if( yd >= (y - 18) && yd <= (y + 18)){
      if( xd >= (x - 18) && xd <= (x + 18)){
      	// Perde uma vida sempre que é atingido.
        vidas--;
        
        // Controla a repetição de tiros.
        yd = 0;
        xd = 0;
        
        
        //alvox = 0;
        //alvoy = 0;
      }
    }
  
  if( x < 18 )
    x = 18;
  if( y < 18 )
    y = 18;
  if( y > height-18 )
    y = height-18;
  if( x > width-18 )
    x = width-18;
  
  if((x-18) >= (xinimigo-(tamanhoInimigo/2)) && (x+18) <= (xinimigo+(tamanhoInimigo/2)) ){
    if( (y-18) >= (yinimigo-(tamanhoInimigo/2)) && (y+18) <= (yinimigo+(tamanhoInimigo/2))){
      vidas-=1;
    }
  } else{
    if(xinimigo-(tamanhoInimigo/2) >= x-18)
      xinimigo--;
    else
      xinimigo++;
    
    if(yinimigo-(tamanhoInimigo/2) >= y-18)
      yinimigo--;
    else
      yinimigo++;
  }
  
  
  if( fruta == true ){
  	if( y-18 >= 390 && y+18 <= 410 )
    	if(x-18 >= 90 && x+18 <= 110)
	    	vidas++;
  } else{
    if( xd >= 90 && xd <= 110){
      if( yd >= 390 && yd <= 410){
        life_fruta--;
        yd = 0;
        xd = 0;
        
        fruta = true;
      }
    }
  }
  
  // Texto das vidas.
  textSize(20);
  fill(200, 200, 40);
  text("VIDAS: " + vidas, 400, 60); //texto
  text("NIVEL: " + nivel, 400, 20);
   
  if( vidas == 0 ){
	  background(0);
    textSize(40);
    fill(200, 200, 40);
    text("GAME OVER", 250, 250);
    exit(0);
  }
  
  if( nivel == 6 ){
	  background(0);
    textSize(40);
    fill(200,200,40);
    text("VENCEDOR", 250, 250);
    exit(0);
  }
  
}
